<p-toast position="center"></p-toast>
<div class="pnl-content p-3">
    <div class="row no-gutters">
        <div class="col-lg-12">
            <div class="box">
                <div class="row no-gutters justify-content-center">
                    <div class="col-lg-12 col-sm-12 align-self-center">
                        <ul class="list-inline panel-breadcrumb">
                            <li class="list-inline-item pointer" [routerLink]="['/']">سامانه اعتبارات</li>
                            <li class="list-inline-item current">فرم گزارشگیری واحدهای فناور</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="pnl-content p-3">
    <div class="row">
        <div class="col-lg-12">
            <div class="box">
                <div class="row mt-3 justify-content-center">
                    <div class="col-lg-4 col-sm-12 mb-3">
                        <span class="p-fluid">
                            <p-autoComplete [lazy]="true" [dropdown]="true" (onSelect)="onSelectUnit($event)"
                                (onClear)="onSelectUnit($event)" [suggestions]="filteredUnits"
                                placeholder="نوع واحد فناور" (completeMethod)="filterUnit($event)" field="title">
                            </p-autoComplete>
                        </span>
                    </div>
                    <div class="col-lg-4 col-sm-12 mb-3">
                        <ng-persian-datepicker [dateInitValue]=false (dateOnSelect)="onSelectDateFrom($event)">
                            <div class="input-container">
                                <input type="text" placeholder="تاریخ پذیرش از" [formControl]="dateValueMin" />
                                <i class="pi pi-calendar"></i>
                            </div>
                        </ng-persian-datepicker>
                    </div>
                    <div class="col-lg-4 col-sm-12 mb-3">
                        <ng-persian-datepicker [dateInitValue]=false (dateOnSelect)="onSelectDateTo($event)">
                            <div class="input-container">
                                <input type="text" placeholder="تاریخ پذیرش تا" [formControl]="dateValueMax" />
                                <i class="pi pi-calendar"></i>
                            </div>
                        </ng-persian-datepicker>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-12 col-sm-12">
                        <p-divider styleClass="justify-content-center">
                            <span class="p-tag">انتخاب فیلدهای خروجی</span>
                        </p-divider>
                        <ul class="field ml-4 mr-4 mt-5">
                            <li *ngFor="let item of cols">
                                <p-checkbox name="groupname" [binary]="true" value="item.header"
                                    (onChange)="onClickselectCol(item.field,item.header,$event)">
                                </p-checkbox>
                                {{ item.header }}
                            </li>
                        </ul>
                    </div>
                </div>
                <!-- <div class="row">
                    <div class="col d-flex flex-row-reverse">
                        <button pButton pRipple label="جستجو" (click)="advanceSearchUnit()"></button>
                    </div>
                </div> -->
            </div>
        </div>
    </div>


    <div class="pnl-content p-3">
        <div class="row">
            <div class="col-lg-12">
                <div class="box">
                    <p-toolbar styleClass="mb-4">
                        <ng-template pTemplate="right">
                            <div class="flex">
                                <button type="button" pButton pRipple icon="pi pi-file" (click)="exportCSV()"
                                    class="mr-1" pTooltip="CSV" tooltipPosition="bottom"></button>
                                <button type="button" pButton pRipple icon="pi pi-file-excel" (click)="exportExcel()"
                                    class="p-button-success mr-1" pTooltip="XLS" tooltipPosition="bottom"></button>
                                <button type="button" pButton pRipple icon="pi pi-file-pdf" (click)="exportPdf()"
                                    class="p-button-warning mr-1" pTooltip="PDF" tooltipPosition="bottom"></button>
                                <button type="button" pButton pRipple icon="pi pi-file" (click)="exportPdf()"
                                    class="p-button-primary mr-1" pTooltip="DOCX" tooltipPosition="bottom"></button>
                            </div>
                        </ng-template>
                        <ng-template pTemplate="left">
                            <button pButton pRipple label="New" icon="pi pi-plus"
                                class="p-button-success ml-1"></button>
                            <button pButton pRipple label="Delete" icon="pi pi-trash" class="p-button-danger"></button>
                        </ng-template>
                    </p-toolbar>


                    <p-table #dt [columns]="selectedCol" [value]="results" selectionMode="multiple"
                        [exportHeader]="'header'" dataKey="_id" [rows]="10" [showCurrentPageReport]="true"
                        [paginator]="true" [scrollable]="true" scrollHeight="600px"
                        currentPageReportTemplate="{first} تا {last} از {totalRecords}" [filterDelay]="0"
                        [globalFilterFields]="['companyID', 'ceoFullName', 'companyName','ceoMobile','unitType']">
                        <ng-template pTemplate="header" let-columns>
                            <tr>
                                <th style="width: 3rem"></th>
                                <th *ngFor="let col of columns; let i = index;">
                                    {{col.header}}
                                </th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-rowData let-columns="columns" let-expanded="expanded">
                            <tr [pSelectableRow]="rowData">
                                <td *ngIf="selectedCol.length>0">
                                    <button type="button" pButton pRipple [pRowToggler]="rowData"
                                        class="p-button-text p-button-rounded p-button-plain"
                                        [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"></button>
                                </td>
                                <td *ngFor="let col of columns">
                                    {{rowData[col.field]}}
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="rowexpansion" let-rowData>
                            <tr>
                                <td colspan="7">
                                    <div class="p-3">
                                        <p-table [value]="rowData.members" dataKey="_id">
                                            <ng-template pTemplate="header">
                            <tr>
                                <th>نام و نام خانوادگی</th>
                                <th>شماره همراه</th>
                                <th>جایگاه</th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-member>
                            <tr>
                                <td>{{member.fullName}}</td>
                                <td>{{member.mobile}}</td>
                                <td>{{member.position}}</td>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="emptymessage">
                            <tr>
                                <td colspan="6">اطلاعاتی ثبت نشده است</td>
                            </tr>
                        </ng-template>
                    </p-table>
                </div>
                </td>
                </tr>
                </ng-template>
                </p-table>
            </div>
        </div>
    </div>
</div>